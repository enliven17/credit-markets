/* eslint-disable @typescript-eslint/no-unused-vars */`n/* eslint-disable @typescript-eslint/no-explicit-any */`n"use client";`n`nimport { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";`nimport { Badge } from "@/components/ui/badge";`nimport { Button } from "@/components/ui/button";`nimport { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";`nimport { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";`nimport { PointsManager } from "@/lib/points-system"; // ğŸ¯ USE YOUR POINTS SYSTEM`nimport { useAuth } from "@/providers/auth-provider";`nimport {`n  getUsersByAddresses,`n  formatUserDisplayName,`n  formatUserShortName,`n  User,`n  checkUsersInSupabase,`n  getUserDisplayInfo,`n} from "@/utils/supabase/user";`nimport {`n  Award,`n  BarChart3,`n  Crown,`n  Medal,`n  Target,`n  Trophy,`n  Users,`n  Zap,`n} from "lucide-react";`nimport { useEffect, useState } from "react";`n`ninterface LeaderboardUser {`n  user_address: string;`n  total_points: number;`n  total_staked: number;`n  total_winnings: number;`n  total_losses: number;`n  markets_participated: number;`n  win_streak: number;`n  current_streak: number;`n  longest_win_streak: number;`n  rank: number;`n  username?: string;`n  display_name?: string;`n  profile_image_url?: string;`n  supabaseUser?: User | null; // Add this to store the actual Supabase user data`n  hasProfile?: boolean; // Add this to track if user has a profile`n}`n`nexport default function LeaderboardPage() {`n  const [users, setUsers] = useState<LeaderboardUser[]>([]);`n  const [loading, setLoading] = useState(true);`n  const [error, setError] = useState<string | null>(null);`n  const [category, setCategory] = useState<`n    "total-points" | "market-creation" | "betting" | "resolution"`n  >("total-points");`n  const [timeframe, setTimeframe] = useState<"all-time" | "monthly" | "weekly">(`n    "all-time",`n  );`n`n  const { user } = useAuth();`n  const [userRank, setUserRank] = useState<LeaderboardUser | null>(null);`n  const fetchLeaderboard = async () => {`n    try {`n      setLoading(true);`n      setError(null);`n`n      console.log("ğŸ† Fetching leaderboard data...");`n`n      // Get leaderboard data from your PointsManager`n      const leaderboardData = await PointsManager.getLeaderboard(100);`n`n      if (leaderboardData.length === 0) {`n        setUsers([]);`n        setLoading(false);`n        return;`n      }`n`n      // Extract all user addresses`n      const userAddresses = leaderboardData.map((entry) => entry.user_address);`n`n      // Check which users exist in Supabase`n      console.log("ğŸ‘¥ Checking users in Supabase...");`n      const supabaseUsersMap = await checkUsersInSupabase(userAddresses);`n`n      // Log some stats`n      const foundUsers = Array.from(supabaseUsersMap.values()).filter(`n        (user) => user !== null,`n      );`n      console.log(`n        `âœ… Found ${foundUsers.length} users in Supabase out of ${userAddresses.length} total`,`n      );`n`n      // Format the data with real user information`n      const formattedUsers: LeaderboardUser[] = leaderboardData.map(`n        (entry, index) => {`n          const supabaseUser = supabaseUsersMap.get(entry.user_address);`n          const displayInfo = getUserDisplayInfo(`n            supabaseUser!,`n            entry.user_address,`n          );`n`n          return {`n            user_address: entry.user_address,`n            total_points: entry.total_points || 0,`n            total_staked: entry.total_staked || 0,`n            total_winnings: entry.total_winnings || 0,`n            total_losses: entry.total_losses || 0,`n            markets_participated: entry.markets_participated || 0,`n            win_streak: entry.win_streak || 0,`n            current_streak: entry.current_streak || 0,`n            longest_win_streak: entry.longest_win_streak || 0,`n            rank: index + 1,`n            username: displayInfo.shortName,`n            display_name: displayInfo.displayName,`n            profile_image_url: displayInfo.avatarUrl,`n            supabaseUser,`n            hasProfile: displayInfo.hasProfile,`n          };`n        },`n      );`n`n      // Sort by total points (highest first)`n      formattedUsers.sort((a, b) => b.total_points - a.total_points);`n`n      // Re-assign ranks after sorting`n      formattedUsers.forEach((user, index) => {`n        user.rank = index + 1;`n      });`n`n      setUsers(formattedUsers);`n`n      // Find current user's rank`n      if (user?.addr) {`n        const currentUserEntry = formattedUsers.find(`n          (u) => u.user_address === user.addr,`n        );`n        setUserRank(currentUserEntry || null);`n      }`n    } catch (err: any) {`n      console.error("âŒ Error fetching leaderboard:", err);`n      setError(err.message || "Failed to fetch leaderboard");`n    } finally {`n      setLoading(false);`n    }`n  };`n`n  useEffect(() => {`n    fetchLeaderboard();`n  }, [user?.addr]);`n`n  const getRankIcon = (rank: number) => {`n    switch (rank) {`n      case 1:`n        return <Crown className="h-5 w-5 text-yellow-500" />;`n      case 2:`n        return <Medal className="h-5 w-5 text-gray-400" />;`n      case 3:`n        return <Medal className="h-5 w-5 text-amber-600" />;`n      default:`n        return <span className="text-lg font-bold text-gray-400">#{rank}</span>;`n    }`n  };`n`n  const getValueByCategory = (user: LeaderboardUser) => {`n    switch (category) {`n      case "total-points":`n        return `${user.total_points.toLocaleString()} pts`;`n      case "market-creation":`n        return `${user.markets_participated} markets`; // Using markets_participated since we don't have markets_created`n      case "betting":`n        return `${user.total_staked.toFixed(2)} tCTC staked`;`n      case "resolution":`n        return `${user.total_winnings.toFixed(2)} tCTC won`;`n      default:`n        return `${user.total_points.toLocaleString()} pts`;`n    }`n  };`n`n  const getSortedUsers = () => {`n    const sortedUsers = [...users];`n    switch (category) {`n      case "total-points":`n        return sortedUsers.sort((a, b) => b.total_points - a.total_points);`n      case "market-creation":`n        return sortedUsers.sort(`n          (a, b) => b.markets_participated - a.markets_participated,`n        );`n      case "betting":`n        return sortedUsers.sort((a, b) => b.total_staked - a.total_staked);`n      case "resolution":`n        return sortedUsers.sort((a, b) => b.total_winnings - a.total_winnings);`n      default:`n        return sortedUsers;`n    }`n  };`n`n  const getCategoryLabel = () => {`n    switch (category) {`n      case "total-points":`n        return "Credit Predict Points (All Time)";`n      case "market-creation":`n        return "Markets Participated";`n      case "betting":`n        return "Total Staked";`n      case "resolution":`n        return "Total Winnings";`n      default:`n        return "Credit Predict Points";`n    }`n  };`n`n  if (loading) {`n    return (`n      <div className="min-h-screen bg-[#0A0C14] flex items-center justify-center">`n        <div className="text-center">`n          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-[#9b87f5] mx-auto mb-4"></div>`n          <p className="text-gray-400">Loading leaderboard...</p>`n        </div>`n      </div>`n    );`n  }`n`n  if (error) {`n    return (`n      <div className="min-h-screen bg-[#0A0C14] flex items-center justify-center">`n        <div className="text-center">`n          <p className="text-red-400 mb-4">{error}</p>`n          <Button onClick={fetchLeaderboard}>Try Again</Button>`n        </div>`n      </div>`n    );`n  }`n`n  const sortedUsers = getSortedUsers();`n`n  return (`n    <div className="min-h-screen bg-[#0A0C14]">`n      <div className="container mx-auto px-4 py-8">`n        {/* Header */}`n        <div className="bg-gradient-to-br from-[#1A1F2C] via-[#151923] to-[#0A0C14] rounded-2xl border border-gray-800/50 p-8 shadow-2xl mb-8">`n          <div className="flex items-center gap-3 mb-4">`n            <Trophy className="h-8 w-8 text-yellow-500" />`n            <h1 className="text-3xl font-bold text-white">`n              Credit Predict Leaderboard`n            </h1>`n          </div>`n          <p className="text-gray-400 mb-4">`n            Top performers in the Credit Predict Points system`n          </p>`n`n          {/* Current User Rank */}`n          {user && userRank && (`n            <div className="flex items-center gap-4 p-4 bg-[#9b87f5]/10 border border-[#9b87f5]/20 rounded-lg">`n              <div className="flex items-center gap-2">`n                <Award className="h-5 w-5 text-[#9b87f5]" />`n                <span className="text-white font-medium">Your Rank:</span>`n              </div>`n              <Badge className="bg-[#9b87f5]/20 text-[#9b87f5] border-[#9b87f5]/30">`n                #{userRank.rank}`n              </Badge>`n              <div className="text-gray-400">`n                {userRank.total_points.toLocaleString()} Credit Predict Points`n              </div>`n            </div>`n          )}`n`n          {/* Quick Stats */}`n          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">`n            <div className="bg-[#0A0C14]/50 rounded-lg p-3 text-center">`n              <p className="text-2xl font-bold text-white">{users.length}</p>`n              <p className="text-xs text-gray-400">Total Users</p>`n            </div>`n            <div className="bg-[#0A0C14]/50 rounded-lg p-3 text-center">`n              <p className="text-2xl font-bold text-[#9b87f5]">`n                {users`n                  .reduce((sum, u) => sum + u.total_points, 0)`n                  .toLocaleString()}`n              </p>`n              <p className="text-xs text-gray-400">Total Points</p>`n            </div>`n            <div className="bg-[#0A0C14]/50 rounded-lg p-3 text-center">`n              <p className="text-2xl font-bold text-green-400">`n                {users.reduce((sum, u) => sum + u.total_staked, 0).toFixed(0)}`n              </p>`n              <p className="text-xs text-gray-400">Total Staked</p>`n            </div>`n            <div className="bg-[#0A0C14]/50 rounded-lg p-3 text-center">`n              <p className="text-2xl font-bold text-yellow-400">`n                {users.reduce((sum, u) => sum + u.markets_participated, 0)}`n              </p>`n              <p className="text-xs text-gray-400">Markets</p>`n            </div>`n          </div>`n        </div>`n`n        {/* Category Selection */}`n        <div className="mb-8">`n          <Card className="bg-gradient-to-br from-[#1A1F2C] to-[#151923] border-gray-800/50">`n            <CardHeader>`n              <CardTitle className="text-white text-sm">`n                Ranking Category`n              </CardTitle>`n            </CardHeader>`n            <CardContent>`n              <Tabs`n                value={category}`n                onValueChange={(value) => setCategory(value as any)}`n              >`n                <TabsList className="grid w-full grid-cols-4 bg-gray-800/50 text-white">`n                  <TabsTrigger`n                    value="total-points"`n                    className="flex items-center gap-1 text-xs"`n                  >`n                    <Award className="h-3 w-3" />`n                    Points`n                  </TabsTrigger>`n                  <TabsTrigger`n                    value="market-creation"`n                    className="flex items-center gap-1 text-xs"`n                  >`n                    <BarChart3 className="h-3 w-3" />`n                    Markets`n                  </TabsTrigger>`n                  <TabsTrigger`n                    value="betting"`n                    className="flex items-center gap-1 text-xs"`n                  >`n                    <Target className="h-3 w-3" />`n                    Staked`n                  </TabsTrigger>`n                  <TabsTrigger`n                    value="resolution"`n                    className="flex items-center gap-1 text-xs"`n                  >`n                    <Zap className="h-3 w-3" />`n                    Winnings`n                  </TabsTrigger>`n                </TabsList>`n              </Tabs>`n            </CardContent>`n          </Card>`n        </div>`n`n        {/* Top 3 Podium */}`n        {sortedUsers.length >= 3 && (`n          <div className="mb-8">`n            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">`n              {sortedUsers.slice(0, 3).map((user, index) => (`n                <Card`n                  key={user.user_address}`n                  className={`bg-gradient-to-br from-[#1A1F2C] to-[#151923] border-gray-800/50 relative overflow-hidden ${`n                    index === 0`n                      ? "ring-2 ring-yellow-500/50"`n                      : index === 1`n                        ? "ring-2 ring-gray-400/50"`n                        : "ring-2 ring-amber-600/50"`n                  }`}`n                >`n                  <CardHeader className="text-center pb-4">`n                    <div className="flex justify-center mb-4">`n                      {getRankIcon(index + 1)}`n                    </div>`n                    <Avatar className="h-16 w-16 mx-auto mb-4">`n                      <AvatarImage`n                        src={user.profile_image_url}`n                        alt={user.username}`n                      />`n                      <AvatarFallback className="bg-[#9b87f5]/20 text-[#9b87f5]">`n                        {user.user_address.slice(2, 4).toUpperCase()}`n                      </AvatarFallback>`n                    </Avatar>`n                    <CardTitle className="flex items-center justify-center gap-2 text-white">`n                      {user.display_name}`n                    </CardTitle>`n                  </CardHeader>`n                  <CardContent className="text-center">`n                    <div className="space-y-3">`n                      <div>`n                        <p className="text-sm text-gray-400">`n                          Credit Predict Points`n                        </p>`n                        <p className="text-xl font-bold text-[#9b87f5]">`n                          {user.total_points.toLocaleString()}`n                        </p>`n                      </div>`n                      <div className="grid grid-cols-2 gap-4 text-sm">`n                        <div>`n                          <p className="text-gray-400">Staked</p>`n                          <p className="font-medium text-white">`n                            {user.total_staked.toFixed(1)}`n                          </p>`n                        </div>`n                        <div>`n                          <p className="text-gray-400">Winnings</p>`n                          <p className="font-medium text-white">`n                            {user.total_winnings.toFixed(1)}`n                          </p>`n                        </div>`n                      </div>`n                      <div className="text-center">`n                        <Badge className="bg-[#9b87f5]/20 text-[#9b87f5] border-[#9b87f5]/30 text-xs">`n                          Rank #{index + 1}`n                        </Badge>`n                      </div>`n                    </div>`n                  </CardContent>`n                </Card>`n              ))}`n            </div>`n          </div>`n        )}`n`n        {/* Full Leaderboard */}`n        <Card className="bg-gradient-to-br from-[#1A1F2C] to-[#151923] border-gray-800/50">`n          <CardHeader>`n            <CardTitle className="flex items-center justify-between text-white">`n              <span>{getCategoryLabel()}</span>`n              <Badge className="bg-blue-500/20 text-blue-400 border-blue-500/30">`n                <Users className="h-3 w-3 mr-1" />`n                {sortedUsers.length} Users`n              </Badge>`n            </CardTitle>`n          </CardHeader>`n          <CardContent>`n            <div className="space-y-4">`n              {sortedUsers.length === 0 ? (`n                <div className="text-center py-12 text-gray-400">`n                  <Trophy className="h-16 w-16 mx-auto mb-4 opacity-50" />`n                  <p className="text-lg mb-2">No users found</p>`n                  <p className="text-sm">`n                    Start betting to appear on the leaderboard!`n                  </p>`n                </div>`n              ) : (`n                sortedUsers.map((user, index) => (`n                  <div`n                    key={user.user_address}`n                    className={`flex items-center justify-between p-4 rounded-lg border transition-colors cursor-pointer ${`n                      user.user_address === `${user?.user_address}``n                        ? "bg-[#9b87f5]/10 border-[#9b87f5]/30 hover:bg-[#9b87f5]/20"`n                        : "bg-[#0A0C14]/50 border-gray-800/30 hover:bg-gray-800/20"`n                    }`}`n                    onClick={() =>`n                      (window.location.href = `/dashboard/${user.user_address}`)`n                    }`n                  >`n                    <div className="flex items-center gap-4">`n                      <div className="flex items-center justify-center w-8">`n                        {getRankIcon(index + 1)}`n                      </div>`n                      <Avatar className="h-10 w-10">`n                        <AvatarImage`n                          src={user.profile_image_url}`n                          alt={user.username}`n                        />`n                        <AvatarFallback className="bg-[#9b87f5]/20 text-[#9b87f5]">`n                          {user.user_address.slice(2, 4).toUpperCase()}`n                        </AvatarFallback>`n                      </Avatar>`n                      <div>`n                        <div className="flex items-center gap-2">`n                          <h3 className="font-medium text-white">`n                            {user.display_name}`n                          </h3>`n                          {index < 10 && (`n                            <Badge className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30 text-xs">`n                              Top 10`n                            </Badge>`n                          )}`n                        </div>`n                        <div className="flex gap-4 text-sm text-gray-400">`n                          <span>{user.username}</span>`n                          <span>{user.total_points} pts</span>`n                          <span>{user.markets_participated} markets</span>`n                        </div>`n                      </div>`n                    </div>`n                    <div className="text-right">`n                      <div className="text-lg font-bold text-[#9b87f5]">`n                        {getValueByCategory(user)}`n                      </div>`n                      <div className="text-sm text-gray-400">`n                        Rank #{index + 1}`n                      </div>`n                    </div>`n                  </div>`n                ))`n              )}`n            </div>`n          </CardContent>`n        </Card>`n`n        {/* Join Competition Banner */}`n        <Card className="bg-gradient-to-br from-[#1A1F2C] via-[#151923] to-[#0A0C14] rounded-2xl border border-gray-800/50 p-8  mt-8 text-white">`n          <CardContent className="p-6">`n            <div className="flex flex-col md:flex-row items-center justify-between gap-4">`n              <div>`n                <h3 className="text-xl font-bold mb-2 flex items-center gap-2">`n                  <Trophy className="h-6 w-6 text-yellow-600" />`n                  Climb the Leaderboard!`n                </h3>`n                <p className="opacity-90">`n                  Earn Credit Predict Points by creating markets, placing bets, and`n                  staying active.`n                </p>`n              </div>`n              <Button`n                variant="secondary"`n                className="bg-[#9b87f5] text-white hover:!bg-inherit"`n                onClick={() => (window.location.href = "/markets")}`n              >`n                Start Earning Points`n              </Button>`n            </div>`n          </CardContent>`n        </Card>`n      </div>`n    </div>`n  );`n}