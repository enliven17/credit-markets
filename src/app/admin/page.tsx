/* eslint-disable @typescript-eslint/no-unused-vars */`n `n/* eslint-disable @typescript-eslint/no-explicit-any */`n"use client";`n`nimport { useState, useEffect } from "react";`nimport Link from "next/link";`nimport { useRouter } from "next/navigation";`nimport { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";`nimport { Button } from "@/components/ui/button";`nimport { Badge } from "@/components/ui/badge";`nimport { Alert, AlertDescription } from "@/components/ui/alert";`nimport { useAuth } from "@/providers/auth-provider";`nimport {`n  getAllMarkets,`n  getPlatformStats,`n  getPendingMarkets,`n  withdrawAllPlatformFeesTransaction as adminWithdrawAllPlatformFeesTransaction,`n} from "@/lib/flow-wager-scripts";`nimport * as fcl from "@onflow/fcl";`nimport {`n  Plus,`n  BarChart3,`n  DollarSign,`n  AlertTriangle,`n  Clock,`n  Download,`n  RefreshCw,`n  Shield,`n  Activity,`n  Target,`n  Coins,`n} from "lucide-react";`nimport type { Market } from "@/types/market";`nimport { Input } from "@/components/ui/input";`nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";`nimport { toast } from "sonner";`n`ninterface AdminStats {`n  totalMarkets: number;`n  activeMarkets: number;`n  pendingResolution: number;`n  totalVolume: string;`n  avgMarketVolume: string;`n}`n`nexport default function AdminPage() {`n  const { user, isAuthenticated:loggedIn } = useAuth();`n  const router = useRouter();`n  `n  const [isLoading, setIsLoading] = useState(false);`n  const [adminStats, setAdminStats] = useState({`n    totalMarkets: 0,`n    activeMarkets: 0,`n    pendingResolution: 0,`n    totalVolume: "0.0",`n    avgMarketVolume: "0.0",`n  });`n  const [recentMarkets, setRecentMarkets] = useState<Market[]>([]);`n  const [pendingMarkets, setPendingMarkets] = useState<Market[]>([]);`n  const [error, setError] = useState<string | null>(null);`n  // Remove contractInfo state and all references to it`n`n  // Add state for market search/filter/sort`n  const [marketSearch, setMarketSearch] = useState("");`n  const [marketStatusFilter, setMarketStatusFilter] = useState("all");`n  const [marketSort, setMarketSort] = useState("newest");`n  // Add state for user management (placeholder)`n  const [userSearch, setUserSearch] = useState("");`n  const [users, setUsers] = useState<any[]>([]); // Replace with real user data integration`n`n  // Add state for withdraw`n  const [withdrawing, setWithdrawing] = useState(false);`n  const [withdrawError, setWithdrawError] = useState<string | null>(null);`n  const [availableFees, setAvailableFees] = useState("0.0");`n`n  // Check if user is admin (for now, just check if connected)`n  const isAdmin = loggedIn && user?.addr;`n`n  // Fetch admin dashboard data`n  const fetchAdminData = async () => {`n    setIsLoading(true);`n    setError(null);`n    try {`n      // Fetch platform stats`n      const platformStatsScript = await getPlatformStats();`n      const stats = await fcl.query({ cadence: platformStatsScript });`n      setAvailableFees(stats.availableFeesForWithdrawal?.toString() || "0.0");`n      // Fetch all markets`n      const allMarketsScript = await getAllMarkets();`n      const markets = await fcl.query({ cadence: allMarketsScript });`n      // Fetch pending markets (PendingResolution status)`n      const pendingMarketsScript = await getPendingMarkets();`n      const pendingResolutionMarkets = await fcl.query({ cadence: pendingMarketsScript });`n      // Find markets that are Active but have ended`n      const now = Date.now() / 1000;`n      const endedActiveMarkets = (markets || []).filter((market: any) => {`n        return market.status === 0 && parseFloat(market.endTime) < now;`n      });`n      // Merge and deduplicate by market.id`n      const pendingMap = new Map();`n      (pendingResolutionMarkets || []).forEach((m: any) => pendingMap.set(m.id, m));`n      (endedActiveMarkets || []).forEach((m: any) => pendingMap.set(m.id, m));`n      setAdminStats({`n        totalMarkets: stats.totalMarkets || 0,`n        activeMarkets: stats.activeMarkets || 0,`n        pendingResolution: (markets || []).filter((m: any) => m.status === 1).length,`n        totalVolume: stats.totalVolume?.toString() || "0.0",`n        avgMarketVolume: stats.totalMarkets > 0`n          ? (parseFloat(stats.totalVolume) / stats.totalMarkets).toFixed(2)`n          : "0.0",`n      });`n      setRecentMarkets(markets || []);`n      setPendingMarkets(Array.from(pendingMap.values()));`n    } catch (error: any) {`n      setError(`Failed to load admin dashboard data: ${error.message}`);`n    } finally {`n      setIsLoading(false);`n    }`n  };`n`n  useEffect(() => {`n    if (isAdmin) {`n      fetchAdminData();`n    }`n  }, [isAdmin, user]);`n`n  const handleRefresh = async () => {`n    await fetchAdminData();`n  };`n`n  const formatCurrency = (value: string | number) => {`n    const num = typeof value === "string" ? parseFloat(value) : value;`n    if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;`n    if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;`n    return num.toFixed(2);`n  };`n`n  const getStatusColor = (status: number) => {`n    switch (status) {`n      case 0: // Active`n        return "text-green-400 bg-green-500/20 border-green-500/30";`n      case 1: // Paused`n        return "text-yellow-400 bg-yellow-500/20 border-yellow-500/30";`n      case 2: // Resolved`n        return "text-blue-400 bg-blue-500/20 border-blue-500/30";`n      default:`n        return "text-gray-400 bg-gray-500/20 border-gray-500/30";`n    }`n  };`n`n  const getCategoryName = (category: number) => {`n    const categories = ["Sports", "Politics", "Economics", "Entertainment", "Technology", "Science", "Weather", "Other"];`n    return categories[category] || "Other";`n  };`n`n  const getStatusName = (status: number) => {`n    const statuses = ["Active", "Pending", "Resolved"];`n    return statuses[status] || "Unknown";`n  };`n`n  // Market filtering, searching, and sorting logic`n  const filteredMarkets: Market[] = recentMarkets`n    .filter((market) =>`n      marketSearch === "" || market.title.toLowerCase().includes(marketSearch.toLowerCase())`n    )`n    .filter((market) =>`n      marketStatusFilter === "all" || getStatusName(market.status) === marketStatusFilter`n    )`n    .sort((a, b) => {`n      if (marketSort === "newest") return parseInt(b.createdAt) - parseInt(a.createdAt);`n      if (marketSort === "oldest") return parseInt(a.createdAt) - parseInt(b.createdAt);`n      if (marketSort === "volume") return parseFloat(b.totalPool) - parseFloat(a.totalPool);`n      return 0;`n    });`n`n  // Withdraw handler`n  const handleWithdrawFees = async () => {`n    setWithdrawing(true);`n    setWithdrawError(null);`n    try {`n      const txScript = await adminWithdrawAllPlatformFeesTransaction();`n      const authorization = fcl.currentUser().authorization;`n      const txId = await fcl.mutate({`n        cadence: txScript,`n        args: (arg, t) => [], // No arguments needed`n        proposer: authorization,`n        payer: authorization,`n        authorizations: [authorization],`n        limit: 1000,`n      });`n      toast.loading("Withdrawing all platform fees...");`n      const result = await fcl.tx(txId).onceSealed();`n      toast.dismiss();`n      if (result.status === 4) {`n        toast.success("All platform fees withdrawn successfully!");`n        // Optionally refresh stats`n        await fetchAdminData();`n      } else {`n        throw new Error(`Transaction failed with status: ${result.status}`);`n      }`n    } catch (err: any) {`n      setWithdrawError(err.message || "Failed to withdraw fees");`n      toast.error("Failed to withdraw fees", { description: err.message });`n    } finally {`n      setWithdrawing(false);`n    }`n  };`n`n  // Show login prompt if not connected`n  if (!loggedIn) {`n    return (`n      <div className="min-h-screen bg-[#0A0C14] flex items-center justify-center p-4">`n        <Card className="bg-gray-900 border-gray-700/50">`n          <CardContent className="bg-gray-900 pt-6 text-center">`n            <Shield className="h-12 w-12 text-[#9b87f5] mx-auto mb-4" />`n            <h2 className="text-xl font-bold text-white mb-2">Connect Your Wallet</h2>`n            <p className="text-gray-400 mb-4">`n              You need to connect your Flow wallet to access the admin panel.`n            </p>`n            <Button `n              onClick={() => router.push("/markets")}`n              className="w-full bg-gradient-to-r from-[#9b87f5] to-[#8b5cf6] hover:from-[#8b5cf6] hover:to-[#7c3aed] text-white"`n            >`n              Go to Markets`n            </Button>`n          </CardContent>`n        </Card>`n      </div>`n    );`n  }`n`n  return (`n    <div className="min-h-screen bg-[#0A0C14]">`n      <div className="container mx-auto px-2 py-4 space-y-6">`n        {/* Header */}`n        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">`n          <div>`n            <div className="flex items-center space-x-3 mb-2">`n              <Shield className="h-8 w-8 text-[#9b87f5]" />`n              <h1 className="text-4xl font-bold text-white">Admin Dashboard</h1>`n            </div>`n            <p className="text-gray-400">`n              Manage markets, users, and platform operations`n            </p>`n            <div className="flex items-center space-x-2 mt-2">`n              <Badge className="bg-[#9b87f5]/20 text-[#9b87f5] border-[#9b87f5]/30">`n                Connected: {user?.addr?.slice(0, 10)}...`n              </Badge>`n              {/* Remove any display of contractInfo and only show platformStats */}`n            </div>`n          </div>`n`n          <div className="flex items-center space-x-3">`n            <Button`n              variant="outline"`n              onClick={handleRefresh}`n              disabled={isLoading}`n              className="border-gray-700 text-gray-300 hover:bg-[#1A1F2C] hover:text-white"`n            >`n              <RefreshCw`n                className={`h-4 w-4 mr-2 ${isLoading ? "animate-spin" : ""}`}`n              />`n              Refresh`n            </Button>`n            <Button `n              variant="outline"`n              className="border-gray-700 text-gray-300 hover:bg-[#1A1F2C] hover:text-white"`n            >`n              <Download className="h-4 w-4 mr-2" />`n              Export`n            </Button>`n            <Button `n              asChild`n              className="bg-gradient-to-r from-[#9b87f5] to-[#8b5cf6] hover:from-[#8b5cf6] hover:to-[#7c3aed] text-white"`n            >`n              <Link href="/admin/create">`n                <Plus className="h-4 w-4 mr-2" />`n                Create Market`n              </Link>`n            </Button>`n          </div>`n        </div>`n`n        {/* Responsive Stats Cards */}`n        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">`n          <Card className="bg-gray-900 border-gray-700/50">`n            <CardContent className="bg-gray-900 p-4 flex flex-col items-center gap-3">`n              <BarChart3 className="h-6 w-6 text-[#9b87f5]" />`n              <span className="text-lg font-bold text-white">{adminStats.totalMarkets}</span>`n              <span className="text-xs sm:text-base text-white">Total Markets</span>`n            </CardContent>`n          </Card>`n          <Card className="bg-gray-900 border-gray-700/50">`n            <CardContent className="bg-gray-900 p-4 flex flex-col items-center gap-3 text-white">`n              <Target className="h-6 w-6 text-blue-400" />`n              <span className="text-lg font-bold text-white">{adminStats.activeMarkets}</span>`n              <span className="text-xs sm:text-base text-white">Active Markets</span>`n            </CardContent>`n          </Card>`n          <Card className="bg-gray-900 border-gray-700/50">`n            <CardContent className="bg-gray-900 p-4 flex flex-col items-center gap-3">`n              <Clock className="h-6 w-6 text-yellow-400" />`n              <span className="text-lg font-bold text-white">{adminStats.pendingResolution}</span>`n              <span className="text-xs sm:text-base text-white">Pending Resolution</span>`n            </CardContent>`n          </Card>`n          <Card className="bg-gray-900 border-gray-700/50">`n            <CardContent className="bg-gray-900 p-4 flex flex-col items-center gap-3">`n              <DollarSign className="h-6 w-6 text-green-400" />`n              <span className="text-lg font-bold text-white">{formatCurrency(adminStats.totalVolume)}</span>`n              <span className="text-xs sm:text-base text-white">Total Volume</span>`n            </CardContent>`n          </Card>`n        </div>`n`n        {/* Pending Markets Section */}`n        {pendingMarkets.length > 0 && (`n          <Card className="bg-gray-900 border-gray-700/50 mt-6">`n            <CardHeader>`n              <CardTitle className="text-white flex items-center gap-2">`n                <AlertTriangle className="h-5 w-5 text-yellow-400" />`n                Pending Markets ({pendingMarkets.length})`n              </CardTitle>`n            </CardHeader>`n            <CardContent>`n              <div className="overflow-x-auto rounded-lg border border-gray-800/50">`n                <table className="min-w-full text-sm">`n                  <thead>`n                    <tr className="bg-[#151923]">`n                      <th className="px-2 py-2 text-white">Title</th>`n                      <th className="px-2 py-2 text-white">Status</th>`n                      <th className="px-2 py-2 text-white">Volume</th>`n                      <th className="px-2 py-2 text-white">Actions</th>`n                    </tr>`n                  </thead>`n                  <tbody>`n                    {pendingMarkets.map((market) => (`n                      <tr key={market.id} className="border-b border-gray-800">`n                        <td className="px-2 py-2 text-white">{market.title}</td>`n                        <td className="px-2 py-2 text-white">{market.status === 1 ? "Pending Resolution" : "Ended (Unresolved)"}</td>`n                        <td className="px-2 py-2 text-white">{formatCurrency(market.totalPool)}</td>`n                        <td className="px-2 py-2 text-white">`n                          <Link href={`/markets/${market.id}`}>`n                            <Button size="sm" className="w-full md:w-auto text-white">View</Button>`n                          </Link>`n                        </td>`n                      </tr>`n                    ))}`n                  </tbody>`n                </table>`n              </div>`n            </CardContent>`n          </Card>`n        )}`n`n        {/* Platform Fees Withdraw Card (Admins only) */}`n        {isAdmin && (`n          <div className="w-full max-w-xl mx-auto mb-6">`n            <Card className="bg-gray-900 border border-gray-700 rounded-xl p-6 flex flex-col gap-4 shadow-lg">`n              <CardContent className="bg-gray-900">`n                <div className="flex items-center gap-2 mb-2">`n                  <Coins className="h-5 w-5 text-white" />`n                  <span className="text-lg font-semibold text-white">Platform Fees</span>`n                  <span className="ml-2 text-sm text-white">{formatCurrency(availableFees)} FLOW available</span>`n                </div>`n                <p className="text-gray-400 text-sm mb-2">Withdraw accumulated platform fees to the admin wallet.</p>`n                {withdrawError && (`n                  <div className="text-red-400 text-xs mb-2">{withdrawError}</div>`n                )}`n                <Button`n                  onClick={handleWithdrawFees}`n                  disabled={withdrawing || parseFloat(availableFees) <= 0}`n                  className="bg-gradient-to-r from-[#9b87f5] to-[#8b5cf6] hover:from-[#8b5cf6] hover:to-[#7c3aed] text-white font-bold h-12 w-full"`n                >`n                  {withdrawing ? "Withdrawing..." : "Withdraw Platform Fees"}`n                </Button>`n              </CardContent>`n            </Card>`n          </div>`n        )}`n`n        {/* Market Management Section */}`n        <Card className="bg-gradient-to-br from-[#1A1F2C] to-[#151923] border border-gray-800/50 rounded-xl p-4">`n          <CardContent className="bg-gradient-to-br from-[#1A1F2C] to-[#151923]">`n            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">`n              <div className="flex flex-col sm:flex-row gap-2 w-full md:w-auto">`n                <Input`n                  placeholder="Search markets..."`n                  value={marketSearch}`n                  onChange={e => setMarketSearch(e.target.value)}`n                  className="w-full sm:w-64"`n                />`n                <Select value={marketStatusFilter} onValueChange={setMarketStatusFilter}>`n                  <SelectTrigger className="w-full sm:w-40 text-white">`n                    <SelectValue placeholder="Status" className="text-white" />`n                  </SelectTrigger>`n                  <SelectContent className="bg-gray-800 text-white border-0">`n                    <SelectItem value="all" className="text-white">All Statuses</SelectItem>`n                    <SelectItem value="Active" className="text-white">Active</SelectItem>`n                    <SelectItem value="Resolved" className="text-white">Resolved</SelectItem>`n                    <SelectItem value="Cancelled" className="text-white">Cancelled</SelectItem>`n                  </SelectContent>`n                </Select>`n                <Select value={marketSort} onValueChange={setMarketSort}>`n                  <SelectTrigger className="w-full sm:w-40 text-white">`n                    <SelectValue placeholder="Sort by" className="text-white" />`n                  </SelectTrigger>`n                  <SelectContent className="bg-gray-800 text-white border-0">`n                    <SelectItem value="newest" className="text-white">Newest</SelectItem>`n                    <SelectItem value="oldest" className="text-white">Oldest</SelectItem>`n                    <SelectItem value="volume" className="text-white">Volume</SelectItem>`n                  </SelectContent>`n                </Select>`n              </div>`n              <div className="flex gap-2 w-full md:w-auto">`n                <Button onClick={handleRefresh} disabled={isLoading} className="w-full md:w-auto text-white">`n                  <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? "animate-spin" : ""}`} />`n                  Refresh`n                </Button>`n                <Button asChild className="w-full md:w-auto bg-gradient-to-r from-[#9b87f5] to-[#8b5cf6] text-white">`n                  <Link href="/admin/create">`n                    <Plus className="h-4 w-4 mr-2" />Create Market`n                  </Link>`n                </Button>`n              </div>`n            </div>`n            <div className="overflow-x-auto rounded-lg border border-gray-800/50">`n              <table className="min-w-full text-sm">`n                <thead>`n                  <tr className="bg-[#151923]">`n                    <th className="px-2 py-2 text-white">Title</th>`n                    <th className="px-2 py-2 hidden md:table-cell text-white">Status</th>`n                    <th className="px-2 py-2 text-white">Volume</th>`n                    <th className="px-2 py-2 text-white">Actions</th>`n                  </tr>`n                </thead>`n                <tbody>`n                  {filteredMarkets.map((market) => (`n                    <tr key={market.id} className="border-b border-gray-800">`n                      <td className="px-2 py-2 text-white">{market.title}</td>`n                      <td className="px-2 py-2 hidden md:table-cell text-white">{getStatusName(market.status)}</td>`n                      <td className="px-2 py-2 text-white">{formatCurrency(market.totalPool)}</td>`n                      <td className="px-2 py-2 text-white">`n                        <Link href={`/markets/${market.id}`}>`n                          <Button size="sm" className="w-full md:w-auto text-white">View</Button>`n                        </Link>`n                      </td>`n                    </tr>`n                  ))}`n                </tbody>`n              </table>`n            </div>`n          </CardContent>`n        </Card>`n`n        {/* User Management Section (placeholder for future integration) */}`n        <Card className="bg-gradient-to-br from-[#1A1F2C] to-[#151923] border border-gray-800/50 rounded-xl p-4">`n          <CardContent className="bg-gradient-to-br from-[#1A1F2C] to-[#151923] text-white">`n            <h2 className="text-lg font-bold text-white mb-4">User Management</h2>`n            <div className="flex flex-col sm:flex-row gap-2 mb-4">`n              <Input`n                placeholder="Search users by address or username..."`n                value={userSearch}`n                onChange={e => setUserSearch(e.target.value)}`n                className="w-full sm:w-64"`n              />`n            </div>`n            <div className="overflow-x-auto rounded-lg border border-gray-800/50">`n              <table className="min-w-full text-sm">`n                <thead>`n                  <tr className="bg-[#151923]">`n                    <th className="px-2 py-2 text-white">Address</th>`n                    <th className="px-2 py-2 text-white">Username</th>`n                    <th className="px-2 py-2 text-white">Markets Created</th>`n                    <th className="px-2 py-2 text-white">Actions</th>`n                  </tr>`n                </thead>`n                <tbody>`n                  {/* Placeholder: Replace with real user data integration */}`n                  {users.length === 0 ? (`n                    <tr>`n                      <td colSpan={4} className="text-center text-gray-400 py-4 text-white">`n                        User management coming soon...`n                      </td>`n                    </tr>`n                  ) : (`n                    users`n                      .filter(user =>`n                        userSearch === "" ||`n                        user.address.toLowerCase().includes(userSearch.toLowerCase()) ||`n                        (user.username && user.username.toLowerCase().includes(userSearch.toLowerCase()))`n                      )`n                      .map(user => (`n                        <tr key={user.address} className="border-b border-gray-800">`n                          <td className="px-2 py-2 font-mono text-white">{user.address}</td>`n                          <td className="px-2 py-2 text-white">{user.username || "-"}</td>`n                          <td className="px-2 py-2 text-white">{user.marketsCreated || 0}</td>`n                          <td className="px-2 py-2 text-white">`n                            <Button size="sm" className="w-full md:w-auto text-white">View</Button>`n                          </td>`n                        </tr>`n                      ))`n                  )}`n                </tbody>`n              </table>`n            </div>`n          </CardContent>`n        </Card>`n`n        {/* Contract Info Section */}`n        {/* Remove any display of contractInfo and only show platformStats */}`n`n        {/* Error Alert */}`n        {error && (`n          <Alert className="bg-red-500/10 border-red-500/30 text-red-400 mt-4">`n            <AlertTriangle className="h-4 w-4" />`n            <AlertDescription>{error}</AlertDescription>`n          </Alert>`n        )}`n      </div>`n    </div>`n  );`n}