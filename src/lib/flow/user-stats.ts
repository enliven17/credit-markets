/* eslint-disable @typescript-eslint/no-explicit-any */`nimport flowConfig from "@/lib/flow/config";`nimport { UserStats } from "@/types/user";`nimport * as fcl from "@onflow/fcl";`nimport { safeToNumber, safeToString, safeToUInt64 } from "../utils";`n`nconst contractAddress =`n  process.env.NEXT_PUBLIC_Credit Predict_TESTNET_CONTRACT || "0xfb16e84ea1882f67"; // Default to Credit Predict contract address`n  `n// Create fallback user stats matching your UserStats interface`nexport const createFallbackUserStats = (userAddress: string): UserStats => {`n  return {`n    address: userAddress,`n    totalWinnings: 0,`n    totalBets: 0,`n    winCount: 0,`n    currentStreak: 0,`n    longestStreak: 0,`n    totalFeesPaid: 0,`n    totalInvested: 0,`n    winRate: 0,`n    roi: 0,`n    rank: undefined,`n    // Optional backward compatibility fields`n    totalMarketsParticipated: 0,`n    totalLosses: 0,`n    winStreak: 0,`n  };`n};`n`n// Transform raw user stats from contract to match your UserStats interface`nconst transformUserStats = (rawStats: any, userAddress: string): UserStats => {`n  if (!rawStats) {`n    console.warn("âš ï¸ No raw stats data, using fallback");`n    return createFallbackUserStats(userAddress);`n  }`n`n  console.log("ğŸ”„ Transforming raw user stats:", rawStats);`n`n  // Extract values from contract's UserStats struct`n  const totalMarketsParticipated = safeToUInt64(`n    rawStats.totalMarketsParticipated,`n    0`n  );`n  const totalWinnings = safeToNumber(rawStats.totalWinnings, 0);`n  const totalLosses = safeToNumber(rawStats.totalLosses, 0);`n  const winStreak = safeToUInt64(rawStats.winStreak, 0);`n  const currentStreak = safeToUInt64(rawStats.currentStreak, 0);`n  const longestWinStreak = safeToUInt64(rawStats.longestWinStreak, 0);`n  const totalStaked = safeToNumber(rawStats.totalStaked, 0);`n  // const averageBetSize = safeToNumber(rawStats.averageBetSize, 0);`n  const contractRoi = safeToNumber(rawStats.roi, 0);`n`n  // Calculate derived stats for your interface`n  const totalBets = totalMarketsParticipated; // Total markets = total bets`n  const winCount = winStreak; // winStreak in contract represents total wins`n  const totalInvested = totalStaked; // totalStaked = totalInvested`n  const winRate = totalBets > 0 ? (winCount / totalBets) * 100 : 0;`n  const roi = contractRoi; // Use ROI from contract`n`n  // Estimate total fees paid (3% platform fee)`n  const platformFeePercentage = 3.0;`n  const totalFeesPaid = (totalInvested * platformFeePercentage) / 100;`n`n  const transformedStats: UserStats = {`n    address: userAddress,`n    totalWinnings,`n    totalBets,`n    winCount,`n    currentStreak,`n    longestStreak: longestWinStreak,`n    totalFeesPaid,`n    totalInvested,`n    winRate,`n    roi,`n    rank: undefined, // You might calculate this elsewhere`n    // Optional backward compatibility fields`n    totalMarketsParticipated,`n    totalLosses,`n    winStreak,`n  };`n`n  console.log("âœ… Transformed user stats:", transformedStats);`n  return transformedStats;`n};`n`n// Fetch user stats using direct contract call`nexport const fetchUserStats = async (`n  userAddress: string`n): Promise<UserStats> => {`n  try {`n    flowConfig();`n    console.log("ğŸ” Fetching user stats for:", userAddress);`n`n    // Use direct contract call to get user stats`n    const script = ``n      import Credit Predict from ${contractAddress}`n`n      access(all) fun main(address: Address): Credit Predict.UserStats? {`n          return Credit Predict.getUserStats(address: address)`n      }`n    `;`n`n    const rawUserStats = await fcl.query({`n      cadence: script,`n      args: (arg: any, t: any) => [arg(userAddress, t.Address)],`n    });`n`n    console.log("ğŸ“Š Raw user stats from contract:", rawUserStats);`n`n    if (!rawUserStats) {`n      console.warn("âš ï¸ No user stats returned from contract, using fallback");`n      return createFallbackUserStats(userAddress);`n    }`n`n    // Transform the raw data to match your UserStats interface`n    const userStats = transformUserStats(rawUserStats, userAddress);`n    console.log("âœ… Final user stats:", userStats);`n`n    return userStats;`n  } catch (error) {`n    console.error("âŒ Error fetching user stats:", error);`n    // Return fallback stats on error`n    return createFallbackUserStats(userAddress);`n  }`n};`n`n// Fetch user profile data separately`nexport const fetchUserProfile = async (userAddress: string) => {`n  try {`n    flowConfig();`n    console.log("ğŸ” Fetching user profile for:", userAddress);`n`n    const script = ``n      import Credit Predict from 0xb17b2ac32498a3f9`n`n      access(all) fun main(address: Address): Credit Predict.UserProfile? {`n          return Credit Predict.getUserProfile(address: address)`n      }`n    `;`n`n    const rawProfile = await fcl.query({`n      cadence: script,`n      args: (arg: any, t: any) => [arg(userAddress, t.Address)],`n    });`n`n    console.log("ğŸ“Š Raw user profile from contract:", rawProfile);`n`n    if (!rawProfile) {`n      console.warn("âš ï¸ No user profile found for address:", userAddress);`n      return null;`n    }`n`n    // Transform profile data`n    const transformedProfile = {`n      address: userAddress,`n      username: safeToString(rawProfile.username),`n      displayName: safeToString(rawProfile.displayName),`n      bio: safeToString(rawProfile.bio),`n      profileImageUrl: safeToString(rawProfile.profileImageUrl),`n      joinedAt: safeToNumber(rawProfile.joinedAt, 0),`n    };`n`n    console.log("âœ… Transformed user profile:", transformedProfile);`n    return transformedProfile;`n  } catch (error) {`n    console.error("âŒ Error fetching user profile:", error);`n    return null;`n  }`n};`n`n// Fetch user positions`nexport const fetchUserPositions = async (userAddress: string) => {`n  try {`n    flowConfig();`n    console.log("ğŸ” Fetching user positions for:", userAddress);`n`n    const script = ``n      import Credit Predict from 0xb17b2ac32498a3f9`n`n      access(all) fun main(address: Address): {UInt64: Credit Predict.UserPosition} {`n          return Credit Predict.getUserPositions(address: address)`n      }`n    `;`n`n    const rawPositions = await fcl.query({`n      cadence: script,`n      args: (arg: any, t: any) => [arg(userAddress, t.Address)],`n    });`n`n    console.log("ğŸ“Š Raw user positions from contract:", rawPositions);`n    return rawPositions || {};`n  } catch (error) {`n    console.error("âŒ Error fetching user positions:", error);`n    return {};`n  }`n};`n`n// Fetch claimable winnings`nexport const fetchClaimableWinnings = async (userAddress: string) => {`n  try {`n    flowConfig();`n    console.log("ğŸ” Fetching claimable winnings for:", userAddress);`n`n    const script = ``n      import Credit Predict from 0xb17b2ac32498a3f9`n`n      access(all) fun main(address: Address): [Credit Predict.ClaimableWinnings] {`n          return Credit Predict.getClaimableWinnings(address: address)`n      }`n    `;`n`n    const rawWinnings = await fcl.query({`n      cadence: script,`n      args: (arg: any, t: any) => [arg(userAddress, t.Address)],`n    });`n`n    console.log("ğŸ“Š Raw claimable winnings from contract:", rawWinnings);`n    return rawWinnings || [];`n  } catch (error) {`n    console.error("âŒ Error fetching claimable winnings:", error);`n    return [];`n  }`n};