/* eslint-disable @typescript-eslint/no-explicit-any */`n// lib/flow/user-dashboard-service.ts`nimport * as fcl from "@onflow/fcl";`nimport flowConfig from "@/lib/flow/config";`nimport type { Market } from "@/types/market";`nimport React from "react";`nimport { `n  getUserProfile as getUserProfileScript,`n  getUserPositions as getUserPositionsScript,`n  getMarketCreator as getMarketCreatorScript,`n  getUserDashboardData as getUserDashboardDataScript`n} from "@/lib/flow-wager-scripts";`n`n// Initialize Flow configuration`nconst initConfig = async () => {`n  flowConfig();`n};`n`n// User dashboard service functions using your scripts`nexport const getUserProfile = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    const script = await getUserProfileScript();`n    const profile = await fcl.query({`n      cadence: script,`n      args: (arg, t) => [arg(userAddress, t.Address)]`n    });`n`n    return profile;`n  } catch (error) {`n    console.error(`Failed to fetch user profile for ${userAddress}:`, error);`n    throw error;`n  }`n};`n`nexport const getUserPositions = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    const script = await getUserPositionsScript();`n    const positions = await fcl.query({`n      cadence: script,`n      args: (arg, t) => [arg(userAddress, t.Address)]`n    });`n`n    return positions || {};`n  } catch (error) {`n    console.error(`Failed to fetch user positions for ${userAddress}:`, error);`n    throw error;`n  }`n};`n`nexport const getUserCreatedMarkets = async (userAddress: string): Promise<Market[]> => {`n  try {`n    await initConfig();`n    `n    const script = await getMarketCreatorScript();`n    const markets = await fcl.query({`n      cadence: script,`n      args: (arg, t) => [arg(userAddress, t.Address)]`n    });`n`n    // Transform contract data to Market interface`n    return markets?.map((market: any) => ({`n      id: market.id.toString(),`n      title: market.title,`n      description: market.description,`n      category: parseInt(market.category.rawValue),`n      optionA: market.optionA,`n      optionB: market.optionB,`n      creator: market.creator,`n      createdAt: market.createdAt.toString(),`n      endTime: market.endTime.toString(),`n      minBet: market.minBet.toString(),`n      maxBet: market.maxBet.toString(),`n      status: parseInt(market.status.rawValue),`n      outcome: market.outcome ? parseInt(market.outcome.rawValue) : undefined,`n      resolved: market.resolved,`n      totalOptionAShares: market.totalOptionAShares.toString(),`n      totalOptionBShares: market.totalOptionBShares.toString(),`n      totalPool: market.totalPool.toString(),`n      imageUrl: market.imageUrl || ""`n    })) || [];`n  } catch (error) {`n    console.error(`Failed to fetch created markets for ${userAddress}:`, error);`n    throw error;`n  }`n};`n`nexport const getUserTradingHistory = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    // For now, return empty array since trading history tracking might not be implemented yet`n    // You can implement this when you add event tracking to your contract`n    return [];`n  } catch (error) {`n    console.error(`Failed to fetch trading history for ${userAddress}:`, error);`n    return [];`n  }`n};`n`nexport const getUserLeaderboardRank = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    // For now, return 0 since leaderboard might not be implemented yet`n    // You can implement this when you add leaderboard logic to your contract`n    return 0;`n  } catch (error) {`n    console.error(`Failed to fetch leaderboard rank for ${userAddress}:`, error);`n    return 0;`n  }`n};`n`n// Enhanced batch fetch using your comprehensive dashboard script`nexport const getUserDashboardData = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    // Use your comprehensive getUserDashboardData script`n    const script = await getUserDashboardDataScript();`n    const dashboardData = await fcl.query({`n      cadence: script,`n      args: (arg, t) => [arg(userAddress, t.Address)]`n    });`n`n    // Also fetch created markets separately since it's not in the dashboard script`n    const createdMarkets = await getUserCreatedMarkets(userAddress);`n`n    return {`n      profile: dashboardData.profile,`n      stats: dashboardData.stats,`n      positions: dashboardData.positions,`n      claimableWinnings: dashboardData.claimableWinnings,`n      wagerPoints: dashboardData.wagerPoints,`n      createdMarkets,`n      tradingHistory: [] // Placeholder until implemented`n    };`n  } catch (error) {`n    console.error(`Failed to fetch dashboard data for ${userAddress}:`, error);`n    `n    // Fallback: fetch data individually if batch fails`n    try {`n      const [profile, positions, createdMarkets] = await Promise.all([`n        getUserProfile(userAddress),`n        getUserPositions(userAddress),`n        getUserCreatedMarkets(userAddress)`n      ]);`n`n      return {`n        profile,`n        stats: null,`n        positions,`n        claimableWinnings: [],`n        wagerPoints: 0,`n        createdMarkets,`n        tradingHistory: []`n      };`n    } catch (fallbackError) {`n      console.error('Fallback fetch also failed:', fallbackError);`n      throw error;`n    }`n  }`n};`n`n// React hook for user dashboard data`ntype UserDashboardData = {`n  profile: any;`n  stats: any;`n  positions: any;`n  claimableWinnings: any[];`n  wagerPoints: number;`n  createdMarkets: Market[];`n  tradingHistory: any[];`n};`n`nexport const useUserDashboard = (userAddress: string) => {`n  const [data, setData] = React.useState<UserDashboardData | null>(null);`n  const [loading, setLoading] = React.useState(true);`n  const [error, setError] = React.useState<string | null>(null);`n`n  const fetchData = React.useCallback(async () => {`n    if (!userAddress) return;`n    `n    try {`n      setLoading(true);`n      setError(null);`n      const dashboardData = await getUserDashboardData(userAddress);`n      setData(dashboardData);`n    } catch (err) {`n      setError(err instanceof Error ? err.message : 'Failed to fetch user data');`n    } finally {`n      setLoading(false);`n    }`n  }, [userAddress]);`n`n  React.useEffect(() => {`n    fetchData();`n  }, [fetchData]);`n`n  return { data, loading, error, refetch: fetchData };`n};`n`n// Additional helper functions for specific data`nexport const getClaimableWinnings = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    const dashboardData = await getUserDashboardData(userAddress);`n    return dashboardData.claimableWinnings || [];`n  } catch (error) {`n    console.error(`Failed to fetch claimable winnings for ${userAddress}:`, error);`n    return [];`n  }`n};`n`nexport const getWagerPoints = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    const dashboardData = await getUserDashboardData(userAddress);`n    return dashboardData.wagerPoints || 0;`n  } catch (error) {`n    console.error(`Failed to fetch wager points for ${userAddress}:`, error);`n    return 0;`n  }`n};`n`nexport const getUserStats = async (userAddress: string) => {`n  try {`n    await initConfig();`n    `n    const dashboardData = await getUserDashboardData(userAddress);`n    return dashboardData.stats;`n  } catch (error) {`n    console.error(`Failed to fetch user stats for ${userAddress}:`, error);`n    return null;`n  }`n};