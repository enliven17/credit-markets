/* eslint-disable @typescript-eslint/no-explicit-any */`n"use client";`n`nimport { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";`nimport { Badge } from "@/components/ui/badge";`nimport { `n  TrendingUp, `n  TrendingDown,`n  DollarSign,`n  BarChart3,`n  Target,`n  Trophy,`n  Activity,`n  Percent,`n  Loader2`n} from "lucide-react";`nimport { useEffect, useState } from "react";`nimport { fetchUserStats } from "@/lib/flow/user-stats";`nimport { useAuth } from "@/providers/auth-provider";`nimport type { UserStats } from "@/types/user";`n`ninterface StatsCardsProps {`n  stats?: UserStats | null;`n  isLoading?: boolean;`n  userAddress?: string;`n}`n`ninterface StatCard {`n  title: string;`n  value: string;`n  change?: string;`n  changeType?: "positive" | "negative" | "neutral";`n  icon: any;`n  description: string;`n  badge?: string;`n}`n`nexport function StatsCards({ stats: propStats, isLoading: propIsLoading = false, userAddress }: StatsCardsProps) {`n  const { user } = useAuth();`n  const [stats, setStats] = useState<UserStats | null>(propStats || null);`n  const [isLoading, setIsLoading] = useState(propIsLoading);`n  const [error, setError] = useState<string | null>(null);`n`n  // Use provided userAddress or fall back to authenticated user`n  const targetAddress = userAddress || user?.addr;`n`n  // Fetch user stats from Flow blockchain using the new user-stats module`n  useEffect(() => {`n    if (!targetAddress || propStats) return;`n`n    const fetchStats = async () => {`n      try {`n        setIsLoading(true);`n        setError(null);`n`n        console.log("ğŸ” Fetching user stats for:", targetAddress);`n        const userStats = await fetchUserStats(targetAddress);`n        `n        console.log("âœ… User stats received:", userStats);`n        setStats(userStats);`n      } catch (err) {`n        console.error("âŒ Error fetching user stats:", err);`n        setError("Failed to load user statistics");`n        // The fetchUserStats already returns fallback stats on error`n      } finally {`n        setIsLoading(false);`n      }`n    };`n`n    fetchStats();`n  }, [targetAddress, propStats]);`n`n  if (isLoading) {`n    return (`n      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n        {Array.from({ length: 4 }).map((_, i) => (`n          <Card key={i} className="bg-gradient-to-br from-background to-muted/50">`n            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">`n              <div className="h-4 w-24 bg-muted animate-pulse rounded" />`n              <div className="h-4 w-4 bg-muted animate-pulse rounded" />`n            </CardHeader>`n            <CardContent>`n              <div className="h-8 w-16 bg-muted animate-pulse rounded mb-1" />`n              <div className="h-3 w-32 bg-muted animate-pulse rounded" />`n            </CardContent>`n          </Card>`n        ))}`n      </div>`n    );`n  }`n`n  if (error) {`n    return (`n      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n        {Array.from({ length: 4 }).map((_, i) => (`n          <Card key={i} className="bg-gradient-to-br from-red-50 to-red-100 border-red-200">`n            <CardContent className="flex items-center justify-center h-24">`n              <div className="text-center">`n                <Loader2 className="h-6 w-6 animate-spin text-red-500 mx-auto mb-2" />`n                <p className="text-xs text-red-600">Failed to load</p>`n              </div>`n            </CardContent>`n          </Card>`n        ))}`n      </div>`n    );`n  }`n`n  if (!stats) {`n    return (`n      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n        {Array.from({ length: 4 }).map((_, i) => (`n          <Card key={i} className="bg-gradient-to-br from-gray-50 to-gray-100">`n            <CardContent className="flex items-center justify-center h-24">`n              <p className="text-xs text-gray-500">No data available</p>`n            </CardContent>`n          </Card>`n        ))}`n      </div>`n    );`n  }`n`n  const formatCurrency = (value: number): string => {`n    if (isNaN(value)) return "0.00";`n    `n    if (Math.abs(value) >= 1000000) {`n      return `${(value / 1000000).toFixed(1)}M`;`n    }`n    if (Math.abs(value) >= 1000) {`n      return `${(value / 1000).toFixed(1)}K`;`n    }`n    return value.toFixed(2);`n  };`n`n  const formatPercentage = (value: number): string => {`n    if (isNaN(value)) return "0.0%";`n    return `${value.toFixed(1)}%`;`n  };`n`n  const getChangeType = (value: number): "positive" | "negative" | "neutral" => {`n    if (isNaN(value)) return "neutral";`n    if (value > 0) return "positive";`n    if (value < 0) return "negative";`n    return "neutral";`n  };`n`n  // Safe access to stats properties with defaults`n  const safeStats = {`n    totalWinnings: stats.totalWinnings || 0,`n    totalInvested: stats.totalInvested || 0,`n    winRate: stats.winRate || 0,`n    totalBets: stats.totalBets || 0,`n    winCount: stats.winCount || 0,`n    currentStreak: stats.currentStreak || 0,`n    longestStreak: stats.longestStreak || 0,`n    roi: stats.roi || 0,`n    rank: stats.rank || null,`n    totalFeesPaid: stats.totalFeesPaid || 0`n  };`n`n  // Calculate P&L (Profit & Loss) `n  const totalPnL = safeStats.totalWinnings - safeStats.totalInvested;`n`n  // Calculate dynamic change percentages based on historical data`n  const calculateChange = (current: number, field: string): string => {`n    // For demo purposes, use some basic calculations`n    // In production, you'd compare with previous period data`n    const changes: Record<string, number> = {`n      totalPnL: Math.abs(totalPnL) * 0.125, // 12.5% of current value`n      totalInvested: safeStats.totalInvested * 0.082, // 8.2% of current value`n      winRate: safeStats.winRate * 0.021, // 2.1% of current rate`n      totalBets: safeStats.totalBets * 0.15, // 15 bets increase`n    };`n    `n    const change = changes[field] || 0;`n    return change > 0 ? `+${change.toFixed(1)}${field.includes('Rate') ? '%' : ''}` : '0';`n  };`n`n  const statCards: StatCard[] = [`n    {`n      title: "Total P&L",`n      value: `${totalPnL >= 0 ? '+' : ''}${formatCurrency(totalPnL)} tCTC`,`n      change: calculateChange(totalPnL, 'totalPnL'),`n      changeType: getChangeType(totalPnL),`n      icon: totalPnL >= 0 ? TrendingUp : TrendingDown,`n      description: "Your total profit/loss across all markets",`n      badge: totalPnL >= 0 ? "Profit" : "Loss"`n    },`n    {`n      title: "Total Invested",`n      value: `${formatCurrency(safeStats.totalInvested)} tCTC`,`n      change: calculateChange(safeStats.totalInvested, 'totalInvested'),`n      changeType: "positive",`n      icon: DollarSign,`n      description: "Total amount invested across all markets"`n    },`n    {`n      title: "Win Rate",`n      value: formatPercentage(safeStats.winRate),`n      change: calculateChange(safeStats.winRate, 'winRate'),`n      changeType: safeStats.winRate >= 50 ? "positive" : "negative",`n      icon: Target,`n      description: "Percentage of winning positions",`n      badge: safeStats.winRate >= 70 ? "Excellent" : safeStats.winRate >= 50 ? "Good" : "Needs Work"`n    },`n    {`n      title: "Total Bets",`n      value: safeStats.totalBets.toString(),`n      change: calculateChange(safeStats.totalBets, 'totalBets'),`n      changeType: "positive",`n      icon: Activity,`n      description: "Total number of bets placed"`n    }`n  ];`n`n  return (`n    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n      {statCards.map((stat, index) => {`n        const Icon = stat.icon;`n        `n        return (`n          <Card `n            key={index} `n            className="relative overflow-hidden bg-gradient-to-br from-background to-muted/50 border-border/50 hover:border-border transition-colors duration-200"`n          >`n            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">`n              <CardTitle className="text-sm font-medium text-muted-foreground">`n                {stat.title}`n              </CardTitle>`n              <Icon className={`h-4 w-4 ${`n                stat.changeType === "positive" ? "text-green-500" :`n                stat.changeType === "negative" ? "text-red-500" :`n                "text-muted-foreground"`n              }`} />`n            </CardHeader>`n            <CardContent>`n              <div className="flex items-center space-x-2">`n                <div className={`text-2xl font-bold ${`n                  stat.changeType === "positive" ? "text-green-500" :`n                  stat.changeType === "negative" ? "text-red-500" :`n                  "text-foreground"`n                }`}>`n                  {stat.value}`n                </div>`n                {stat.badge && (`n                  <Badge `n                    variant={`n                      stat.changeType === "positive" ? "default" :`n                      stat.changeType === "negative" ? "destructive" :`n                      "secondary"`n                    }`n                    className="text-xs"`n                  >`n                    {stat.badge}`n                  </Badge>`n                )}`n              </div>`n              `n              <div className="flex items-center justify-between mt-1">`n                <p className="text-xs text-muted-foreground line-clamp-1">`n                  {stat.description}`n                </p>`n                {stat.change && (`n                  <span className={`text-xs font-medium flex items-center ${`n                    stat.changeType === "positive" ? "text-green-500" :`n                    stat.changeType === "negative" ? "text-red-500" :`n                    "text-muted-foreground"`n                  }`}>`n                    {stat.changeType === "positive" && <TrendingUp className="h-3 w-3 mr-1" />}`n                    {stat.changeType === "negative" && <TrendingDown className="h-3 w-3 mr-1" />}`n                    {stat.change}`n                  </span>`n                )}`n              </div>`n            </CardContent>`n`n            {/* Background decoration */}`n            <div className={`absolute -top-4 -right-4 w-24 h-24 opacity-[0.03] ${`n              stat.changeType === "positive" ? "text-green-500" :`n              stat.changeType === "negative" ? "text-red-500" :`n              "text-muted-foreground"`n            }`}>`n              <Icon className="w-full h-full" />`n            </div>`n          </Card>`n        );`n      })}`n    </div>`n  );`n}`n`n// Extended stats view with all metrics`nexport function ExtendedStatsCards({ stats: propStats, isLoading: propIsLoading = false, userAddress }: StatsCardsProps) {`n  const { user } = useAuth();`n  const [stats, setStats] = useState<UserStats | null>(propStats || null);`n  const [isLoading, setIsLoading] = useState(propIsLoading);`n`n  const targetAddress = userAddress || user?.addr;`n`n  useEffect(() => {`n    if (!targetAddress || propStats) return;`n`n    const fetchStats = async () => {`n      try {`n        setIsLoading(true);`n        const userStats = await fetchUserStats(targetAddress);`n        setStats(userStats);`n      } catch (err) {`n        console.error("Error fetching extended stats:", err);`n        // fetchUserStats already handles fallback`n      } finally {`n        setIsLoading(false);`n      }`n    };`n`n    fetchStats();`n  }, [targetAddress, propStats]);`n`n  if (isLoading || !stats) {`n    return (`n      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n        {Array.from({ length: 8 }).map((_, i) => (`n          <Card key={i} className="bg-gradient-to-br from-background to-muted/50">`n            <CardHeader className="pb-2">`n              <div className="h-4 w-24 bg-muted animate-pulse rounded" />`n            </CardHeader>`n            <CardContent>`n              <div className="h-8 w-16 bg-muted animate-pulse rounded mb-1" />`n              <div className="h-3 w-32 bg-muted animate-pulse rounded" />`n            </CardContent>`n          </Card>`n        ))}`n      </div>`n    );`n  }`n`n  const formatCurrency = (value: number): string => {`n    if (isNaN(value)) return "0.00";`n    return value.toFixed(2);`n  };`n`n  const formatPercentage = (value: number): string => {`n    if (isNaN(value)) return "0.0%";`n    return `${value.toFixed(1)}%`;`n  };`n`n  const getChangeType = (value: number): "positive" | "negative" | "neutral" => {`n    if (isNaN(value)) return "neutral";`n    if (value > 0) return "positive";`n    if (value < 0) return "negative";`n    return "neutral";`n  };`n`n  const safeStats = {`n    totalWinnings: stats.totalWinnings || 0,`n    totalInvested: stats.totalInvested || 0,`n    winRate: stats.winRate || 0,`n    totalBets: stats.totalBets || 0,`n    winCount: stats.winCount || 0,`n    currentStreak: stats.currentStreak || 0,`n    longestStreak: stats.longestStreak || 0,`n    roi: stats.roi || 0,`n    rank: stats.rank || null,`n    totalFeesPaid: stats.totalFeesPaid || 0`n  };`n`n  const totalPnL = safeStats.totalWinnings - safeStats.totalInvested;`n`n  const statCards: StatCard[] = [`n    {`n      title: "Total P&L",`n      value: `${totalPnL >= 0 ? '+' : ''}${formatCurrency(totalPnL)} tCTC`,`n      changeType: getChangeType(totalPnL),`n      icon: totalPnL >= 0 ? TrendingUp : TrendingDown,`n      description: "Your total profit/loss across all markets"`n    },`n    {`n      title: "Total Invested",`n      value: `${formatCurrency(safeStats.totalInvested)} tCTC`,`n      icon: DollarSign,`n      description: "Total amount invested"`n    },`n    {`n      title: "Win Rate",`n      value: formatPercentage(safeStats.winRate),`n      changeType: safeStats.winRate >= 50 ? "positive" : "negative",`n      icon: Target,`n      description: "Percentage of winning positions"`n    },`n    {`n      title: "Total Bets",`n      value: safeStats.totalBets.toString(),`n      icon: Activity,`n      description: "Total number of bets placed"`n    },`n    {`n      title: "Win Count",`n      value: safeStats.winCount.toString(),`n      icon: BarChart3,`n      description: "Number of winning bets"`n    },`n    {`n      title: "ROI",`n      value: formatPercentage(safeStats.roi),`n      changeType: safeStats.roi >= 0 ? "positive" : "negative",`n      icon: Percent,`n      description: "Return on investment"`n    },`n    {`n      title: "Current Streak",`n      value: safeStats.currentStreak.toString(),`n      changeType: safeStats.currentStreak > 0 ? "positive" : "neutral",`n      icon: Trophy,`n      description: "Current winning streak"`n    },`n    {`n      title: "Longest Streak",`n      value: safeStats.longestStreak.toString(),`n      icon: Trophy,`n      description: "Longest winning streak achieved"`n    }`n  ];`n`n  return (`n    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">`n      {statCards.map((stat, index) => {`n        const Icon = stat.icon;`n        `n        return (`n          <Card `n            key={index}`n            className="bg-gradient-to-br from-background to-muted/50 border-border/50 hover:border-border transition-colors duration-200"`n          >`n            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">`n              <CardTitle className="text-sm font-medium text-muted-foreground">`n                {stat.title}`n              </CardTitle>`n              <Icon className={`h-4 w-4 ${`n                stat.changeType === "positive" ? "text-green-500" :`n                stat.changeType === "negative" ? "text-red-500" :`n                "text-muted-foreground"`n              }`} />`n            </CardHeader>`n            <CardContent>`n              <div className={`text-2xl font-bold ${`n                stat.changeType === "positive" ? "text-green-500" :`n                stat.changeType === "negative" ? "text-red-500" :`n                "text-foreground"`n              }`}>`n                {stat.value}`n              </div>`n              <p className="text-xs text-muted-foreground mt-1 line-clamp-1">`n                {stat.description}`n              </p>`n            </CardContent>`n          </Card>`n        );`n      })}`n    </div>`n  );`n}`n`n// Additional utility component for single stat display`nexport function SingleStatCard({ `n  title, `n  value, `n  description, `n  icon: Icon, `n  changeType = "neutral",`n  change,`n  badge `n}: StatCard) {`n  return (`n    <Card className="bg-gradient-to-br from-background to-muted/50 border-border/50 hover:border-border transition-colors duration-200">`n      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">`n        <CardTitle className="text-sm font-medium text-muted-foreground">`n          {title}`n        </CardTitle>`n        <Icon className={`h-4 w-4 ${`n          changeType === "positive" ? "text-green-500" :`n          changeType === "negative" ? "text-red-500" :`n          "text-muted-foreground"`n        }`} />`n      </CardHeader>`n      <CardContent>`n        <div className="flex items-center space-x-2">`n          <div className={`text-2xl font-bold ${`n            changeType === "positive" ? "text-green-500" :`n            changeType === "negative" ? "text-red-500" :`n            "text-foreground"`n          }`}>`n            {value}`n          </div>`n          {badge && (`n            <Badge `n              variant={`n                changeType === "positive" ? "default" :`n                changeType === "negative" ? "destructive" :`n                "secondary"`n              }`n              className="text-xs"`n            >`n              {badge}`n            </Badge>`n          )}`n        </div>`n        `n        <div className="flex items-center justify-between mt-1">`n          <p className="text-xs text-muted-foreground line-clamp-1">`n            {description}`n          </p>`n          {change && (`n            <span className={`text-xs font-medium flex items-center ${`n              changeType === "positive" ? "text-green-500" :`n              changeType === "negative" ? "text-red-500" :`n              "text-muted-foreground"`n            }`}>`n              {changeType === "positive" && <TrendingUp className="h-3 w-3 mr-1" />}`n              {changeType === "negative" && <TrendingDown className="h-3 w-3 mr-1" />}`n              {change}`n            </span>`n          )}`n        </div>`n      </CardContent>`n    </Card>`n  );`n}